<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <!-- Extend Order Receipt to show Top-Up Order details for Gift List settlements -->
    <t t-name="moombs_list.OrderReceiptTopupSection" t-inherit="point_of_sale.OrderReceipt" t-inherit-mode="extension">
        <!-- Insert Top-Up Order details before the footer -->
        <xpath expr="//div[hasclass('before-footer')]" position="before">
            <!-- Two-Order Flow: Show Top-Up Order details for Settlement Orders -->
            <t t-if="order.topup_order_id">
                <div class="pos-receipt-topup-section pt-3 border-top">
                    <div class="fw-bold text-center">Recarga de Monedero / Wallet Top-Up</div>
                    <div class="d-flex pt-1">
                        <span>N° Recarga:</span>
                        <span t-esc="order.topup_order_id.name or order.topupOrderName" class="ms-auto"/>
                    </div>
                    <div class="d-flex">
                        <span>Importe:</span>
                        <span t-esc="formatCurrency(order.topup_order_id.amount_total || order.topupOrderAmount)" class="ms-auto font-monospace"/>
                    </div>
                    <t t-if="order.topup_order_id.paid_by_partner_id || order.paidByPartnerName">
                        <div class="d-flex">
                            <span>Pagado por:</span>
                            <span t-esc="order.topup_order_id.paid_by_partner_id?.name || order.paidByPartnerName" class="ms-auto"/>
                        </div>
                    </t>
                    <t t-if="order.topupPaymentMethod">
                        <div class="d-flex">
                            <span>Método:</span>
                            <span t-esc="order.topupPaymentMethod" class="ms-auto"/>
                        </div>
                    </t>
                </div>
            </t>
            
            <!-- Show Paid By info for settlement orders (from topup order) -->
            <t t-if="order.topup_order_id and order.topup_order_id.paid_by_partner_id">
                <div class="pos-receipt-paid-by pt-2">
                    <div class="d-flex">
                        <span class="fw-bold">Pagado por / Paid By:</span>
                        <span t-esc="order.topup_order_id.paid_by_partner_id.name" class="ms-auto"/>
                    </div>
                    <t t-if="order.topup_order_id.paid_by_partner_id.vat">
                        <div class="d-flex">
                            <span>DNI/NIF:</span>
                            <span t-esc="order.topup_order_id.paid_by_partner_id.vat" class="ms-auto"/>
                        </div>
                    </t>
                </div>
            </t>
        </xpath>
    </t>
</templates>

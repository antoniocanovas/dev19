<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="view_document_workflow_action_list" model="ir.ui.view">
        <field name="name">document.workflow.action.list</field>
        <field name="model">document.workflow.action</field>
        <field name="arch" type="xml">
            <list decoration-muted="action_type in ['cancellation','api_payment_failed']" 
                  decoration-success="action_type in ['delivery_delivered','api_shipment_delivered','payment_received']"
                  decoration-info="action_source == 'api'"
                  decoration-warning="action_source == 'system'"
                  default_order="date_logged desc">
                <field name="date_logged"/>
                <field name="document_type"/>
                <field name="document_ref"/>
                <field name="action_type"/>
                <field name="action_source"/>
                <field name="state_from"/>
                <field name="state_to"/>
                <field name="user_id"/>
                <field name="partner_id"/>
                <field name="api_provider"/>
                <field name="amount_total" sum="Total"/>
                <field name="duration_seconds"/>
                <field name="is_archived" column_invisible="1"/>
            </list>
        </field>
    </record>
    
    <!-- Search View -->
    <record id="view_document_workflow_action_search" model="ir.ui.view">
        <field name="name">document.workflow.action.search</field>
        <field name="model">document.workflow.action</field>
        <field name="arch" type="xml">
            <search>
                <field name="document_ref"/>
                <field name="partner_id"/>
                <field name="user_id"/>
                <field name="api_provider"/>
                        <field name="baby_list_id" optional="hide"/>
                        <field name="baby_list_item_id" optional="hide"/>
                        <field name="sequence" optional="hide"/>
                <field name="item_action_sequence" optional="hide"/>
                <field name="date_logged"/>
                
                <filter name="user_actions" string="User Actions" domain="[('action_source','=','user')]"/>
                <filter name="api_actions" string="API Actions" domain="[('action_source','=','api')]"/>
                <filter name="system_actions" string="System Actions" domain="[('action_source','=','system')]"/>
                <filter name="state_changes" string="State Changes" domain="[('action_type','=','state_change')]"/>
                <filter name="sale_orders" string="Sale Orders" domain="[('document_type','=','sale_order')]"/>
                <filter name="pickings" string="Pickings" domain="[('document_type','=','picking')]"/>
                <filter name="pos_orders" string="POS Orders" domain="[('document_type','=','pos_order')]"/>
                <filter name="gift_list_items" string="Gift List Items" domain="[('baby_list_item_id','!=',False)]"/>
                <filter name="archived" string="Archived" domain="[('is_archived','=',True)]"/>
                <filter name="active" string="Active" domain="[('is_archived','=',False)]"/>
                
                <group>
                    <filter name="group_document_type" string="Document Type" context="{'group_by': 'document_type'}"/>
                    <filter name="group_action_type" string="Action Type" context="{'group_by': 'action_type'}"/>
                    <filter name="group_action_source" string="Action Source" context="{'group_by': 'action_source'}"/>
                    <filter name="group_user" string="User" context="{'group_by': 'user_id'}"/>
                    <filter name="group_partner" string="Customer" context="{'group_by': 'partner_id'}"/>
                    <filter name="group_date" string="Date" context="{'group_by': 'date_logged:day'}"/>
                    <filter name="group_baby_list_item" string="Gift List Item" context="{'group_by': 'baby_list_item_id'}"/>
                </group>
            </search>
        </field>
    </record>
    
    <!-- Form View -->
    <record id="view_document_workflow_action_form" model="ir.ui.view">
        <field name="name">document.workflow.action.form</field>
        <field name="model">document.workflow.action</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="open_document" string="Open Document" type="object" 
                            icon="fa-external-link" invisible="not res_id"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="document_type"/>
                            <field name="document_ref"/>
                            <field name="action_type"/>
                            <field name="action_source"/>
                        </group>
                        <group>
                            <field name="date_logged"/>
                            <field name="user_id"/>
                            <field name="partner_id"/>
                            <field name="company_id"/>
                        </group>
                    </group>
                    <group>
                        <group>
                            <field name="state_from"/>
                            <field name="state_to"/>
                            <field name="transfer_type"/>
                        </group>
                        <group>
                            <field name="amount_total"/>
                            <field name="currency_id"/>
                            <field name="duration_seconds"/>
                        </group>
                    </group>
                    <group string="External API" invisible="action_source != 'api'">
                        <field name="api_provider"/>
                        <field name="api_response_id"/>
                        <field name="api_webhook_data" widget="text"/>
                    </group>
                    <notebook>
                        <page string="Details">
                            <field name="note" widget="text"/>
                        </page>
                        <page string="Related Actions">
                            <field name="related_action_ids" widget="many2many_tags"/>
                        </page>
                        <page string="Gift List" invisible="not baby_list_item_id">
                            <group>
                                <group>
                                    <field name="baby_list_id"/>
                                    <field name="baby_list_item_id"/>
                                    <field name="sequence" string="Item Sequence"/>
                                    <field name="item_action_sequence" string="Action Sequence"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
    
    <!-- Action -->
    <record id="action_document_workflow_action" model="ir.actions.act_window">
        <field name="name">Workflow Actions</field>
        <field name="res_model">document.workflow.action</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('is_archived', '=', False)]</field>
        <field name="context">{'search_default_active': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No workflow actions yet
            </p>
            <p>
                Workflow actions are automatically logged when documents change state.
            </p>
        </field>
    </record>
</odoo>